<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Scraper Â« le monde Â» et construire ton propre corpus ðŸ‡«ðŸ‡·" href="01_lemonde_fr.html" /><link rel="prev" title="Web Related" href="index.html" />

    <meta name="generator" content="sphinx-3.5.1, furo 2021.02.28.beta28"/>
        <title>Complete tutorial on scraping French news from Le Monde ðŸ‡¬ðŸ‡§ - NLP for French documentation</title>
      <link rel="stylesheet" href="../static/styles/furo.css?digest=be5985a4059b5c2cd56ed0804790452beca62674">
    <link rel="stylesheet" href="../static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../static/custom.css" />
    <link rel="stylesheet" href="../static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">NLP for French  documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../static/nlp_Logo.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../static/nlp_Logo.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">NLP for French  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../nlp/index.html">NLP and Machine Learning-related</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../nlp/01_compara_anno_fr.html">Comparer Spacy, StanfordNLP et TreeTagger sur un corpus oral et un corpus de presse ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlp/02_classification_prenoms_fr.html">Classification de prÃ©noms en genre (masculin/fÃ©minin) ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlp/03_classification_lemonde_fr.html">Text Classification: du TF-IDF aux word embeddings en passant par features expertes ðŸ‡«ðŸ‡·</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../transformers/index.html">Transformers in NLP with PyTorch, TensorFlow and Hugging Face</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../transformers/01_theorie_en.html">10 questions on Bert ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transformers/01_theorie_fr.html">10 questions sur Bert ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../transformers/02_firstBert_fr.html">Classification de commentaires avec Camembert sans prise de tÃªte : les fondamentaux ðŸ‡«ðŸ‡·</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../better_programmer/index.html">Better Programmer</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../better_programmer/01_python_fr.html">Mieux programmer en Python ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../better_programmer/02_git3_en.html">A serious guide to git ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="../better_programmer/03_jupyter_remote_pycharm.html">Connect to remote jupyter notebook in Pycharm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../better_programmer/04_oop_web_scraping_en.html">Understand objected-oriented programming (OOP) by building a minimal Web Scraping framework ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="../better_programmer/05_oop_web_scraping_cooper_en.html">Be a responsible programmer when doing Object-Oriented Programming ðŸ‡¬ðŸ‡§</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../algo/index.html">Algorithms and data structures by examples in Python</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../algo/01_intro_en.html">Algorithm or many ways of solving a problem ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algo/01_intro_fr.html">Algorithme ou plusieurs faÃ§ons de rÃ©soudre un problÃ¨me ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algo/02_ds_en.html">Data structures or many ways of organizing your stuff ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algo/099algo_map.html">Roadmap and cheatsheet of algorithms and data structures</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Web Related</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Complete tutorial on scraping French news from Le Monde ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="01_lemonde_fr.html">Scraper Â« le monde Â» et construire ton propre corpus ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_forum_en.html">On your way to scraping French forums ðŸ‡¬ðŸ‡§</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_django_en.html">Deploying Django app on Ubuntu at digitalocean + SSL certificate ðŸ‡¬ðŸ‡§</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../linguistique_informatique/index.html">Computational Linguistics in R</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../linguistique_informatique/01_zipf_fr.html">La loi de Zipf illustrÃ©e avec gutenbergr en R ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linguistique_informatique/02_mca_ergatif_fr.html">Analyse des Correspondances Multiples : le cas de lâ€™ergatif en warlipiri ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linguistique_informatique/03_pca_inclusion_fr.html">Analyse en composantes principales (PCA) : prÃ©positions dâ€™inclusion en franÃ§ais ðŸ‡«ðŸ‡·</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../high_performance_python/index.html">High performance computing</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../high_performance_python/01_parallel_primer.html">Parallelization in Python: a beginnerâ€™s guide (1, using map)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../codebase/index.html">My Codebase</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../codebase/01_bash.html">My codebase for bash/shell script (macOS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codebase/02_tmux.html">Tumux-related code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codebase/03_python.html">My python codebase (including packages/libraries)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codebase/05_pytorch.html">Pytorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../codebase/06_pandas.html">Pandas codebase</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../math/index.html">Mathematics in Machine Learning and NLP</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../math/01_math_fr.html">Machine Learning : algorithmes et mathÃ©matiques ðŸ‡«ðŸ‡·</a></li>
<li class="toctree-l2"><a class="reference internal" href="../math/01_math_fr.html">Machine Learning : algorithmes et mathÃ©matiques ðŸ‡«ðŸ‡·</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="complete-tutorial-on-scraping-french-news-from-le-monde">
<h1>Complete tutorial on scraping French news from Le Monde ðŸ‡¬ðŸ‡§<a class="headerlink" href="#complete-tutorial-on-scraping-french-news-from-le-monde" title="Permalink to this headline">Â¶</a></h1>
<p><a class="reference external" href="https://scholar.google.fr/citations?user=vKAMMpwAAAAJ&amp;hl=en">Xiaoou WANG</a></p>
<section id="why-you-need-web-scraping-and-why-i-wrote-this-tutorial">
<h2>Why you need web scraping and why I wrote this tutorial<a class="headerlink" href="#why-you-need-web-scraping-and-why-i-wrote-this-tutorial" title="Permalink to this headline">Â¶</a></h2>
<p>Sooner or later in your career you will find yourself in a situation where you need to build your own corpus for common nlp tests.</p>
<p>Some days ago I wrote a tutorial on scraping news on the French journal <code class="docutils literal notranslate"><span class="pre">le</span> <span class="pre">monde</span></code>. I didnâ€™t finish the whole tutorial and today while refreshing some web scraping skills I find the best way to keep a personal knowledge base is writing complete, well documented tutorials. It creates a more robuste and contextualised documentation (like <code class="docutils literal notranslate"><span class="pre">Bert</span></code> :D) than simply commenting code.</p>
</section>
<section id="legal-issues">
<h2>Legal issues<a class="headerlink" href="#legal-issues" title="Permalink to this headline">Â¶</a></h2>
<p>Note that web scraping can cause some legal issues. I just provide a coding tutorial here, please use it at your own risk and read some articles like <a class="reference external" href="https://soshace.com/responsible-web-scraping-gathering-data-ethically-and-legally/">this one</a>.</p>
</section>
<section id="get-article-links">
<h2>Get article links<a class="headerlink" href="#get-article-links" title="Permalink to this headline">Â¶</a></h2>
<p>So the first thing to do is to generate archive links, basically an archive link is a page on which we can scrape article links. For instance, the link <code class="docutils literal notranslate"><span class="pre">https://www.lemonde.fr/archives-du-monde/01-01-2020/</span></code> contains all the articles published for <code class="docutils literal notranslate"><span class="pre">2020â€“01â€“01</span></code>. Here I create the function <code class="docutils literal notranslate"><span class="pre">create_archive_link</span></code> which requires starting year/month/day and ending year/month/day as input. The output is a dictionary in the form of <code class="docutils literal notranslate"><span class="pre">year:links</span></code>.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_archive_links</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span><span class="p">,</span> <span class="n">month_start</span><span class="p">,</span> <span class="n">month_end</span><span class="p">,</span> <span class="n">day_start</span><span class="p">,</span> <span class="n">day_end</span><span class="p">):</span>
    <span class="n">archive_links</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span>
                 <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">month_start</span><span class="p">,</span> <span class="n">month_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span>
                 <span class="nb">range</span><span class="p">(</span><span class="n">day_start</span><span class="p">,</span> <span class="n">day_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">archive_links</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">"https://www.lemonde.fr/archives-du-monde/"</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">archive_links</span>
</pre></div>
</div>
<p>Example output of <code class="docutils literal notranslate"><span class="pre">create_archive_links(2006,2020,1,</span> <span class="pre">12,</span> <span class="pre">1,</span> <span class="pre">31)</span></code>:</p>
<p><img alt="" src="../images/2021-02-20-19-38-41.png"/></p>
<p>The next step is to get all the article links on the archive page. For this you need 3 modules: <code class="docutils literal notranslate"><span class="pre">HTTPError</span></code> to handle exceptions, <code class="docutils literal notranslate"><span class="pre">urlopen</span></code> to open webpages and <code class="docutils literal notranslate"><span class="pre">BeautifulSoup</span></code> to parse webpages.</p>
</section>
<section id="the-magic-power-of-exception-handling">
<h2>The magic power of exception handling<a class="headerlink" href="#the-magic-power-of-exception-handling" title="Permalink to this headline">Â¶</a></h2>
<p>The exception handling is necessary because we have archive pages for dates like 02â€“31, itâ€™s much easier to handle exceptions than generating links corresponding only to existent dates. Each article is in a <code class="docutils literal notranslate"><span class="pre">&lt;section&gt;</span></code> having a <code class="docutils literal notranslate"><span class="pre">class</span></code> named <code class="docutils literal notranslate"><span class="pre">teaser</span></code>.</p>
<p>I also filter out all the non-free articles having a span with class <code class="docutils literal notranslate"><span class="pre">icon__premium</span></code>. All the links containing the word <code class="docutils literal notranslate"><span class="pre">en-direct</span></code> are also filtered because they are videos. This is to say that web scraping requires not only programming skills but also some elementary web analysis.</p>
<p><img alt="" src="../images/2021-02-20-19-39-25.png"/></p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">HTTPError</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="k">def</span> <span class="nf">get_articles_links</span><span class="p">(</span><span class="n">archive_links</span><span class="p">):</span>
    <span class="n">links_non_abonne</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">archive_links</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"url not valid"</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">"html.parser"</span><span class="p">)</span>
            <span class="n">news</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="n">class_</span><span class="o">=</span><span class="s2">"teaser"</span><span class="p">)</span>
            <span class="c1"># condition here : if no span icon__premium (abonnes)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">news</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'span'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'icon__premium'</span><span class="p">}):</span>
                    <span class="n">l_article</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)[</span><span class="s1">'href'</span><span class="p">]</span>
                    <span class="c1"># en-direct = video</span>
                    <span class="k">if</span> <span class="s1">'en-direct'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l_article</span><span class="p">:</span>
                        <span class="n">links_non_abonne</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l_article</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">links_non_abonne</span>
</pre></div>
</div>
</section>
<section id="you-don-t-want-to-scrape-more-than-once">
<h2>You donâ€™t want to scrape more than once<a class="headerlink" href="#you-don-t-want-to-scrape-more-than-once" title="Permalink to this headline">Â¶</a></h2>
<p>Since no body wants to scrape the same links again and again (they are not very likely to change), a handy function can be created to save links into files. Here the publication year is used to name files.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">write_links</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">links</span><span class="p">,</span> <span class="n">year_fn</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s2">"/lemonde*"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year_fn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"\_links.txt"</span><span class="p">),</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">link</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

<span class="n">article_links</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">year</span><span class="p">,</span><span class="n">links</span> <span class="ow">in</span> <span class="n">archive_links</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"processing: "</span><span class="p">,</span><span class="n">year</span><span class="p">)</span>
    <span class="n">article_links_list</span> <span class="o">=</span> <span class="n">get_articles_links</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
    <span class="n">article_links</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">article_links_list</span>
    <span class="n">write_links</span><span class="p">(</span><span class="n">corpus_path</span><span class="p">,</span><span class="n">article_links_list</span><span class="p">,</span><span class="n">year</span><span class="p">)</span>
</pre></div>
</div>
<p>This would produce something like this:</p>
<p><img alt="" src="../images/2021-02-20-19-42-03.png"/></p>
</section>
<section id="let-s-scrape">
<h2>Letâ€™s scrape<a class="headerlink" href="#let-s-scrape" title="Permalink to this headline">Â¶</a></h2>
<p>Now you can scrape article contents, itâ€™s surprisingly straightforward. In fact you just need to get all the <code class="docutils literal notranslate"><span class="pre">h1,h2</span> <span class="pre">and</span> <span class="pre">p</span></code> elements. The <code class="docutils literal notranslate"><span class="pre">recursive=False</span></code> is important here because you donâ€™t want to dig any deeper once you find the text at some first level.</p>
<p>For concerns of modularity you should first write a function to scrape a single page.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_single_page</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"url not valid"</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">"html.parser"</span><span class="p">)</span>
        <span class="n">text_title</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">)</span>
        <span class="n">text_body</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">find_all</span><span class="p">([</span><span class="s2">"p"</span><span class="p">,</span> <span class="s2">"h2"</span><span class="p">],</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">text_title</span><span class="p">,</span> <span class="n">text_body</span><span class="p">)</span>
</pre></div>
</div>
<p>Letâ€™s say you need to classify news by theme (which is very common in text classification tasks), you can use the following function to extract themes from links. For example the link <code class="docutils literal notranslate"><span class="pre">https://www.lemonde.fr/politique/article/2020/01/01/reforme-des-retraites-macron-reste-inflexible-aucune-issue-ne-se-profile_6024550_823448.html</span></code> contains the keyword politique meaning politics in French.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_theme</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">theme_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">'.fr/.*?/'</span><span class="p">,</span> <span class="n">link</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">theme_text</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>You can also get the top n themes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">themes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">list_themes</span><span class="p">(</span><span class="n">links</span><span class="p">):</span>
    <span class="n">themes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
        <span class="n">theme</span> <span class="o">=</span> <span class="n">extract_theme</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">theme</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">themes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">themes</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="n">theme_stat</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">themes</span><span class="p">)</span>
<span class="n">theme_top</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">theme_stat</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="p">:</span>
        <span class="n">theme_top</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
<span class="n">themes_top_five</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">theme_top</span><span class="p">[:</span><span class="mi">5</span><span class="p">]]</span>
</pre></div>
</div>
<p>Now you need to have the links corresponding to the top 5 themes, so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="k">def</span> <span class="nf">classify_links</span><span class="p">(</span><span class="n">theme_list</span><span class="p">,</span> <span class="n">link_list</span><span class="p">):</span>
    <span class="n">dict_links</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">theme</span> <span class="ow">in</span> <span class="n">theme_list</span><span class="p">:</span>
        <span class="n">theme_link</span> <span class="o">=</span> <span class="s1">'https://www.lemonde.fr/'</span> <span class="o">+</span> <span class="n">theme</span> <span class="o">+</span> <span class="s1">'/article/'</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">link_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">theme_link</span> <span class="ow">in</span> <span class="n">link</span><span class="p">:</span>
                <span class="n">dict_links</span><span class="p">[</span><span class="n">theme</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict_links</span>
<span class="n">all_links</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">link_list</span> <span class="ow">in</span> <span class="n">article_links</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">all_links</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">link_list</span><span class="p">)</span>
<span class="n">themes_top_five_links</span> <span class="o">=</span> <span class="n">classify_links</span><span class="p">(</span><span class="n">themes_top_five</span><span class="p">,</span><span class="n">all_links</span><span class="p">)</span>
</pre></div>
</div>
<p>Itâ€™s time to scrape all the articles that you need. Typically you would want to save all the scraped text in a folder. Note that this function takes a dictionary object with theme as key and corresponding links as value. For example here is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> example for the top 5 themes.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">links_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">themes_top_five_links</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, you can scrape ! Note the <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> around <code class="docutils literal notranslate"><span class="pre">range</span></code>, since the whole scraping process could be quite long, you need to keep track of the progress so that you know itâ€™s always running. See how to use <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> here https://tqdm.github.io/. Below is a progress bar example copied from the official documentation.</p>
<p><img alt="" src="../images/2021-02-20-19-45-58.png"/></p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scrape_articles</span><span class="p">(</span><span class="n">dict_links</span><span class="p">):</span>
    <span class="n">themes</span> <span class="o">=</span> <span class="n">dict_links</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">theme</span> <span class="ow">in</span> <span class="n">themes</span><span class="p">:</span>
        <span class="n">create_folder</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'corpus'</span><span class="p">,</span> <span class="n">theme</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"processing:"</span><span class="p">,</span> <span class="n">theme</span><span class="p">)</span>
        <span class="c1">#### note the use tqdm</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_links</span><span class="p">[</span><span class="n">theme</span><span class="p">]))):</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">dict_links</span><span class="p">[</span><span class="n">theme</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">extract_fn</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="n">single_page</span> <span class="o">=</span> <span class="n">get_single_page</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">single_page</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'corpus'</span><span class="p">,</span> <span class="n">theme</span><span class="p">,</span> <span class="n">fn</span> <span class="o">+</span> <span class="s1">'.txt'</span><span class="p">)),</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># f.write(dict_links[theme][i] + "\n" * 2)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">single_page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">single_page</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that you get all the articles as txt, here is a function allowing you to extract any number of texts from each folder. The default number is set to 1000 here.</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cr_corpus_dict</span><span class="p">(</span><span class="n">path_corpus</span><span class="p">,</span> <span class="n">n_files</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">dict_corpus</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">themes</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_corpus</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">theme</span> <span class="ow">in</span> <span class="n">themes</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">theme</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">'.'</span><span class="p">):</span>
            <span class="n">theme_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_corpus</span><span class="p">,</span> <span class="n">theme</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">theme_directory</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">n_files</span><span class="p">:</span>
                    <span class="n">path_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">theme_directory</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">read_file</span><span class="p">(</span><span class="n">path_file</span><span class="p">)</span>
                    <span class="n">dict_corpus</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theme</span><span class="p">)</span>
                    <span class="n">dict_corpus</span><span class="p">[</span><span class="s2">"text"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">dict_corpus</span>
</pre></div>
</div>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">Â¶</a></h2>
<p>Here you are. Happy scraping! And mind the potential legal issues!</p>
<p>You can find source code <a class="reference external" href="https://gist.github.com/xiaoouwang/0f054840af560488f2162c110b6045b5#file-lemondescraper-py">here</a>.</p>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="01_lemonde_fr.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Scraper Â« le monde Â» et construire ton propre corpus ðŸ‡«ðŸ‡·</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Web Related</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2022, Xiaoou Wang
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../sources/web/01_lemonde_en.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Complete tutorial on scraping French news from Le Monde ðŸ‡¬ðŸ‡§</a><ul>
<li><a class="reference internal" href="#why-you-need-web-scraping-and-why-i-wrote-this-tutorial">Why you need web scraping and why I wrote this tutorial</a></li>
<li><a class="reference internal" href="#legal-issues">Legal issues</a></li>
<li><a class="reference internal" href="#get-article-links">Get article links</a></li>
<li><a class="reference internal" href="#the-magic-power-of-exception-handling">The magic power of exception handling</a></li>
<li><a class="reference internal" href="#you-don-t-want-to-scrape-more-than-once">You donâ€™t want to scrape more than once</a></li>
<li><a class="reference internal" href="#let-s-scrape">Letâ€™s scrape</a></li>
<li><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
    <script src="../static/jquery.js"></script>
    <script src="../static/underscore.js"></script>
    <script src="../static/doctools.js"></script>
    <script src="../static/clipboard.min.js"></script>
    <script src="../static/copybutton.js"></script>
    <script src="../static/tabs.js"></script>
    <script >
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-58WGY2PHYB"></script>
<script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-58WGY2PHYB');
</script>
<!-- Default Statcounter code for nlpinfrench
http://nlpinfrench.fr -->
<script type="text/javascript">
var sc_project=12500373;
var sc_invisible=1;
var sc_security="def60251";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics
Made Easy - StatCounter" href="https://statcounter.com/"
target="_blank"><img class="statcounter"
src="https://c.statcounter.com/12500373/0/def60251/1/"
alt="Web Analytics Made Easy -
StatCounter"></a></div></noscript>
<!-- End of Statcounter Code -->
<script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@4.0/dist/gumshoe.polyfills.min.js"></script>
</script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../static/custom.js"></script>
    <script src="../static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>